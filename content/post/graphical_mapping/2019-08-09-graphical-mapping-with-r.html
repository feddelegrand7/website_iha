---
title: Graphical Mapping with R
author: admin
date: '2019-08-09'
slug: graphical-mapping-with-r
categories: []
tags:
  - Map
subtitle: ''
summary: ''
authors: []
lastmod: '2019-08-09T02:14:40+02:00'
featured: no
image:
  caption: ''
  focal_point: ''
  preview_only: no
projects: []
---



<p>Mapping with R is a real joy. To see some examples, we’ll rely on the <a href="https://cran.r-project.org/web/packages/maps/maps.pdf">maps</a> package.</p>
<div id="mapping-the-world" class="section level1">
<h1>Mapping the World</h1>
<div id="getting-the-longitude-and-latitude" class="section level2">
<h2>Getting the longitude and latitude</h2>
<p>First of all, we need to get the long and lat data in order to plot with ggplot2 which provides graphs with more aesthetic. (for an introduction to the ggplot2 package, just click <a href="https://ihaddadenfodil.com/post/an-introduction-to-the-ggplot2-package/">here</a>). To do that, we’ll use the <strong>map_data()</strong> function which belongs to ggplot2 and put as a parameter the <strong>world</strong> map provided by the <strong>maps</strong> package.</p>
<pre class="r"><code>library(maps)
library(tidyverse)</code></pre>
<pre class="r"><code>world &lt;- map_data(&quot;world&quot;)

head(world)</code></pre>
<pre><code>##        long      lat group order region subregion
## 1 -69.89912 12.45200     1     1  Aruba      &lt;NA&gt;
## 2 -69.89571 12.42300     1     2  Aruba      &lt;NA&gt;
## 3 -69.94219 12.43853     1     3  Aruba      &lt;NA&gt;
## 4 -70.00415 12.50049     1     4  Aruba      &lt;NA&gt;
## 5 -70.06612 12.54697     1     5  Aruba      &lt;NA&gt;
## 6 -70.05088 12.59707     1     6  Aruba      &lt;NA&gt;</code></pre>
<p>To render our world geographical plot, we set <em>long</em> to the x-axis and <em>lat</em> to the y-axis. Finally, we set <strong>group = group</strong> (<em>group</em> is a variable that groups each observation according to the corresponding polygon).</p>
<pre class="r"><code>ggplot(world, aes(x=long, y=lat, group=group)) +
  geom_polygon(fill=&quot;lightgreen&quot;, colour=&quot;black&quot;)</code></pre>
<p><img src="/post/graphical_mapping/2019-08-09-graphical-mapping-with-r_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
</div>
</div>
<div id="mapping-regions" class="section level1">
<h1>Mapping Regions</h1>
<p>Now we’ll use the <strong>region</strong> parameter which extracts regional data from the world map. Let’us have a look to the region where I belong to, North Africa:</p>
<pre class="r"><code>north_africa &lt;- map_data(&quot;world&quot;, region = c(
  &quot;Algeria&quot;,
  &quot;Morocco&quot;,
  &quot;Tunisia&quot;,
  &quot;Egypt&quot;,
  &quot;Western Sahara&quot;,
  &quot;Libya&quot;))

head(north_africa)</code></pre>
<pre><code>##       long      lat group order  region subregion
## 1 8.576563 36.93721     1     1 Algeria      &lt;NA&gt;
## 2 8.597656 36.88388     1     2 Algeria      &lt;NA&gt;
## 3 8.601269 36.83393     1     3 Algeria      &lt;NA&gt;
## 4 8.506739 36.78750     1     4 Algeria      &lt;NA&gt;
## 5 8.444238 36.76074     1     5 Algeria      &lt;NA&gt;
## 6 8.369629 36.63252     1     6 Algeria      &lt;NA&gt;</code></pre>
<p>In order to differentiate among countries using colors, we set the parameter <strong>fill = region</strong>.</p>
<pre class="r"><code>ggplot(north_africa, aes(x = long, y = lat, group = group, fill = region)) + 
  geom_polygon(colour = &quot;black&quot;) + # colour = &quot;black&quot; is needed to emphasize borders
  theme_minimal()</code></pre>
<p><img src="/post/graphical_mapping/2019-08-09-graphical-mapping-with-r_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
</div>
<div id="geographical-filling" class="section level1">
<h1>Geographical Filling</h1>
<p>Let us go deeper in our geographical plotting. Suppose we want to plot the French median revenue according to each borough (in french : “arrondissement”). The french median revenue data for 2015 is freely available at the <a href="https://www.insee.fr/fr/statistiques/3560121">INSEE website</a>.</p>
<pre class="r"><code>library(readxl)

fr_median &lt;- read_excel(&quot;base-cc-filosofi-2015.xls&quot;, skip = 5) # keep only the ARR tab in the Excel File. </code></pre>
<p>Furthermore, the <a href="https://whatis.techtarget.com/fileformat/SHP-Shapefile-spatial-data-format-used-by-many-GIS-programs">SHP</a> file for France is available in the <a href="https://www.eea.europa.eu/data-and-maps/data/eea-reference-grids-2/gis-files/france-shapefile">European Environment Agency Data Base</a>. In order to read our SHP file, we’ll rely on the <strong>sf</strong> package.</p>
<pre class="r"><code>library(sf)

fr_map &lt;- sf::st_read(&quot;C:/Users/Administrateur/Desktop/SHP_France/FRA_adm3.shp&quot;, stringsAsFactors = FALSE)</code></pre>
<pre><code>## Reading layer `FRA_adm3&#39; from data source `C:\Users\Administrateur\Desktop\SHP_France\FRA_adm3.shp&#39; using driver `ESRI Shapefile&#39;
## Simple feature collection with 350 features and 13 fields
## geometry type:  MULTIPOLYGON
## dimension:      XY
## bbox:           xmin: -5.143751 ymin: 41.33375 xmax: 9.560416 ymax: 51.0894
## epsg (SRID):    4326
## proj4string:    +proj=longlat +datum=WGS84 +no_defs</code></pre>
<pre class="r"><code>head(fr_map, n = 2)</code></pre>
<pre><code>## Simple feature collection with 2 features and 13 fields
## geometry type:  MULTIPOLYGON
## dimension:      XY
## bbox:           xmin: 7.065385 ymin: 48.33202 xmax: 8.107299 ymax: 49.04169
## epsg (SRID):    4326
## proj4string:    +proj=longlat +datum=WGS84 +no_defs
##   ID_0 ISO NAME_0 ID_1 NAME_1 ID_2   NAME_2 ID_3   NAME_3         TYPE_3
## 1   79 FRA France    1 Alsace    1 Bas-Rhin    1 Haguenau Arrondissement
## 2   79 FRA France    1 Alsace    1 Bas-Rhin    2 Molsheim Arrondissement
##   ENGTYPE_3 NL_NAME_3 VARNAME_3                       geometry
## 1 Districts      &lt;NA&gt;      &lt;NA&gt; MULTIPOLYGON (((7.70342 48....
## 2 Districts      &lt;NA&gt;      &lt;NA&gt; MULTIPOLYGON (((7.317291 48...</code></pre>
<p>Now we’ll combine the <strong>fr_map</strong> and the <strong>fr_median</strong> databases. To do so, we need to provide a common key.The column <strong>NAME_3</strong> in <strong>fr_map</strong> and the column <strong>LIBGEO</strong> in <strong>fr_median</strong> list our French boroughs. As mentioned previously, we must provide a unique key, therefore we’ll rename the <strong>NAME_3</strong> as <strong>LIBGEO</strong>:</p>
<pre class="r"><code>fr_map &lt;- fr_map %&gt;% rename(LIBGEO = NAME_3)</code></pre>
<p>Now we’re ready to combine our databases and drop all values that do not correspond using the <strong>inner_join</strong> function provided by the <em>tidyverse</em> package.</p>
<pre class="r"><code>final &lt;- inner_join(fr_map, fr_median, by = &quot;LIBGEO&quot;)</code></pre>
<p>It’s possible to use the ggplot2 package however I’d rather suggest the <strong>tmap</strong> package:</p>
<pre class="r"><code>library(tmap)

tm_shape(final)+
  tm_polygons(&quot;MED15&quot;, id  = &quot;LIBGEO&quot;)</code></pre>
<p><img src="/post/graphical_mapping/2019-08-09-graphical-mapping-with-r_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
</div>
